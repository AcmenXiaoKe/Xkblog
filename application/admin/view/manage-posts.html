{extend name='common'}
{block name="link"}
<link rel="stylesheet" href="/static/admin/css/manage-posts.css">
<style>
    .pagination {
        margin-top: 25px;
        display: flex;
        justify-content: flex-end;
    }
    .pagination li  {
        cursor: pointer;
        padding: 5px 8px;
        background: var(--Primary);
        margin: 0 3px;
        color: #909399;
    }
    .active , .disabled{
        color: var(--color-white) !important;
    }

</style>
{/block}

{block name="header"}
{include file='common/header'}
{/block}

{block name="main"}
        <div class="layui-body">
            <div class="layui-body_box">
                <div class="layui-body_wrap">
                    <div class="layui-body_wrap_title">文章管理</div>
                    <div class="operation_wrap">
                        <a href="/admin/write_post">
                        <button class="newDate_btn">新增文章</button></a>
                        <div class="screening">
                            <select name="class" class="screening_val">
                                <option value="默认分类">默认分类</option>
                                <option value="JavaScript">JavaScript</option>
                            </select>
                            <button class="screening_btn">筛选</button>
                        </div>
                    </div>
                    <table class="layui-table article_table">
<!--                        <colgroup>-->
<!--                            <col width="150">-->
<!--                            <col width="200">-->
<!--                            <col>-->
<!--                        </colgroup>-->
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>标题</th>
                                <th>作者</th>
                                <th>日期</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                        {volist  name='data' id='item'}
                            <tr>
                                <td>{$item.aid}</td>
                                <td>{$item.title}</td>
                                <td>{$item.author}</td>

                                <td>{$item.release_date}</td>
                                <td>
                                    <input class="xk_checkbox" type="checkbox"  data-id="{$item.aid}" {$item.state == 0  ? '' : 'checked'} >
                                </td>
                                <td>
                                    <div class="article_handle_wrap">
                                        <a href="/admin/write_post?aid={$item.aid}"><button class="article_handle_item edit">
                                            <span class="layui-icon layui-icon-edit article_handle_item_icon"></span>
                                        </button></a>
                                        <button class="article_handle_item delete" onclick="Datadel({$item.aid})">
                                            <span class="layui-icon layui-icon-delete article_handle_item_icon" ></span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        {/volist}
                        </tbody>
                    </table>
<!--                    <div class="paging">-->
<!--                        <div class="previous_page paging_btn">上一页</div>-->
<!--                        <div class="page_item paging_btn">1</div>-->
<!--                        <div class="page_item paging_btn">2</div>-->
<!--                        <div class="page_item paging_btn">3</div>-->
<!--                        <div class="next_page paging_btn">下一页</div>-->
<!--                    </div>-->
                    {$data|raw}
                </div>
            </div>
        </div>
{/block}
{block name="aside"}
{include file='common/aside'}
{/block}
{block name="footer_script"}
<script>
    function Datadel(id) {
        layer.confirm('你确认要删除吗？', {
            btn: ['确认', '取消'] //可以无限个按钮
            ,btn2: function(index, layero){
            }
        }, function(index, layero){
            $.ajax({
                type:'post',
                url:'/admin/write_post/del',
                data:{
                    id
                },
                success:function (result) {
                    if(result.meta.status !== 200) {
                        layer.open({
                            title: '提示信息',
                            content: result.meta.msg,
                        });
                        return
                    }
                    window.location.href="/admin/manage_posts"
                },
                error:function (err){}

            })
            // 隐藏
            $('#layui-layer-shade1').hide()
            layero[0].style.display = 'none'
        });

    }

    $('.xk_checkbox').on('change',function (){
        let state  = this.checked
        let id = this.getAttribute('data-id')
        $.ajax({
            type:"post",
            url:"/admin/manage_posts/edit",
            data:{
                state,
                id
            },
            success:function (res){
                if(res.meta.status == 200) {
                    console.log('修改成功！')
                    return
                }
                console.log('修改失败！')
            }
        })
    })
</script>
{/block}